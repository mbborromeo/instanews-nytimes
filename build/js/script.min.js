document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("stories"),t=document.getElementById("category"),n=document.getElementsByTagName("header")[0],o=document.getElementById("loader");function l(){o.setAttribute("style","display:none")}function a(){const e=document.getElementsByTagName("ul")[0];console.log("builtUL",e),function(e){console.log("checkAllImagesLoaded");let t=!0;const n=e.getElementsByTagName("img");console.log("builtImages",n);for(let e=0;e<n.length;e++){if(console.log("image",e),!0!==n[e].hasAttribute("data-loaded"))return console.log("image not loaded",e),t=!1,!1;console.log("image loaded",e)}return t}(e)&&(console.log("show images"),l(),e.classList.add("show"))}t.addEventListener("change",(function(t){const s=this.value;n.setAttribute("class","shrink"),e.setAttribute("class","expand");let c=document.querySelector("ul");null!==c&&c.parentNode.removeChild(c),o.setAttribute("style","display:flex"),$.ajax({method:"GET",url:`https://api.nytimes.com/svc/topstories/v2/${s}.json?api-key=BvCBQeH2bfwoKZ8Uabwe0ynMvv1yx8VZ`}).done((function(t){if("OK"===t.status&&t.results&&t.results.length>0){!function(t){const n=document.createElement("ul");t.forEach((e,t)=>{const o=document.createElement("li"),l=document.createElement("a");l.setAttribute("href",e.url),l.setAttribute("target","_blank");const s=document.createElement("figure"),c=document.createElement("img");c.setAttribute("alt","Image "+t),c.setAttribute("src",e.multimedia[0].url),c.onload=function(){console.log("image has loaded!",t),this.setAttribute("data-loaded","true"),a()};const i=document.createElement("figcaption"),d=document.createElement("h2");d.innerText=e.title;const r=document.createElement("p");r.innerText=e.abstract,i.append(d),i.append(r),s.append(c),s.append(i),l.append(s),o.append(l),n.append(o)}),e.append(n)}(t.results.filter(e=>e.multimedia&&e.multimedia.length&&e.multimedia[0].url).slice(0,12))}else l(),e.innerText="No articles returned for category "+s})).fail((function(){l(),e.innerText="Error - failed to load articles for category "+s}))}))}));